@{ Layout = null;}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - My ASP.NET Application</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    <link href="~/Content/Common.css" rel="stylesheet" />
    <link href="~/Content/Homepage.css" rel="stylesheet" />
    @Scripts.Render("~/bundles/jquery")
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    @Scripts.Render("~/bundles/bootstrap")
</head>

<body style="background-color:whitesmoke;">
    @model SocialNetwork.WEB.Models.ProfileViewModels.ProfileViewModel
    <div class="navbar navbar-inverse navbar-fixed-top " style="background-color:dimgray;">
        <div class="container">


            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="navbar-collapse collapse" style="margin-left:15%;">
                <ul class="nav navbar-nav">
                    <li><a href="@Url.Action("Homepage","Common")"><span class="glyphicon glyphicon-home"></span>  My profile</a></li>
                    <li><a><span class="glyphicon glyphicon-stats"></span> My statistics</a></li>
                    <li><a href="#"><span class="glyphicon glyphicon-search"></span> Find</a></li>
                    <li><a href="#"><span class="glyphicon glyphicon-tasks"></span> News</a></li>
                    <li><a href="#"><span class="glyphicon glyphicon-cog"></span> Settings</a></li>
                </ul>
                @Html.Partial("_LoginPartial")
            </div>


        </div>

    </div>
    <br>

    <div class="container">
        <div class="row">
            <div class="col-md-10 col-md-offset-2" id="partialsPlace">
                <!--here is partial rendering-->

                @if (Model == null)
                {
                    <div>Cannot show the information</div>
                }
                else
                {
                    {Html.RenderPartial("../Partials/Homepage",Model);}

                }
            </div>



            <script>
                // for homepage only
                function changeTheDisplayedPosts() {
                    var myPublications = $('#myPublications');
                    var myReposts = $('#myReposts');

                    var writePostContainer = $('#write-post-container');
                    var publicationingPost = $('#publicationingPost');
                    var publicationsContainer = $('#publicationsContainer');
                    var repostsContainer = $('#repostsContainer');

                    if (myReposts.css("display") == "none") {
                        myPublications.hide();
                        writePostContainer.hide();
                        publicationsContainer.hide();
                        publicationingPost.hide();

                        myReposts.show();
                        repostsContainer.show();
                    }
                    else {
                        myPublications.show();
                        writePostContainer.show();
                        publicationsContainer.show();

                        repostsContainer.hide();
                        myReposts.hide();
                    }
                    

                }

                function removeNoPublicationsErrorMessage() {
                    $('#noPublicationsErrorMessage').remove();
                }
                //Homepage script
                var totalHashtagsCountInHashtagsContainer = 0;
                function closePostForm() {
                    $('#write-post-container').show();
                    $('#publicationingPost').hide();
                    $('#newPostContent').val("");
                    $('#incorrectHashtagsError').hide();
                    $('#hashtagsContainer').empty();
                }
                function createNewPost() {
                    $('#write-post-container').hide();
                    $('#publicationingPost').show();
                    $('#newPostContent').val("");
                    $('#hashtagsContainer').empty();
                }

                function refreshPublications() { // after refreshing new post will be added

                }
                function addHashtag() {
                    var hashtagsContainer = $('#hashtagsContainer');
                    var newId = 'hashtagSet' + totalHashtagsCountInHashtagsContainer;
                    var newDeleteElementId = 'removeSpan' + totalHashtagsCountInHashtagsContainer;
                    totalHashtagsCountInHashtagsContainer++;

                    hashtagsContainer.append('<div id=' + newId + '><input type="text" name="Hashtags"><a  id=' + newDeleteElementId + '><span class="glyphicon glyphicon-remove"></span></a></div>');

                    $('#' + newDeleteElementId).click(function () {
                        var removingDivId = $('#' + newDeleteElementId).parent().attr('id');
                        $('#' + removingDivId).remove();

                    });

                }

                function checkPostForm() {
                    $("name=Hashtags").each(function (index, value) {
                        value.each(function (index, nestedValue) {
                            if (value == nestedValue) {
                                $('#incorrectHashtagsError').show();
                                return false;
                            }

                        });
                    });
                    var postContent = $('#newPostContent').val();
                    if (postContent == "" || postContent == null || postContent.split(" ") == "") { return false; }
                    $('#incorrectHashtagsError').hide();
                    closePostForm();

                    return true;
                }

                //common
                function setLike(postId, publishedPostLikeId) {
                    var identityName = '@Context.User.Identity.Name';
                    $.ajax({
                        type: 'POST',
                        url: '/Post/Like',
                        data: { "postId": postId,"identityName":identityName},
                        success: function (jsonResult) {
                            var result = JSON.parse(jsonResult);
                            $('#' + publishedPostLikeId).html(result["newLikesCount"]);

                        }
                    });
                }
               
            </script>
            <script>
                $(document).ready(function () {// for Homepage
                    //var publishedPostOnWallCount = $('#publicationsContainer').children().length();
                    var publishedPostsLikes = 0;
                    var publishedPostsLikesId;
                    
                    var repostsLikes = 0;
                    var repostsLikesId;

                    var identityName = '@Context.User.Identity.Name';
                    var publicationsContainer = $('#publicationsContainer');

                    $.ajax({
                        type: 'POST',
                        url: '/Post/Publications',
                        data: { "offset": 0, "identityName": identityName, "count": 10,"postType":"publications" },

                        success: function (jsonResult) {
                            var publicationsContainer = $('#publicationsContainer');
                            var result = JSON.parse(jsonResult);

                            if (result["errorMessage"]) {
                                $('#publicationsContainer').empty();
                                $('#publicationsContainer').append('<div id="noPublicationsErrorMessage" style="text-align:center;"class="common-info-block-text">' + result["errorMessage"] + '</div>');
                                return;
                            }
                            else {
                                //alert(jsonResult);
                                post = "";
                                for (var i = 0; i < result.length; i++) {
                                    publishedPostsLikesId = publishedPostsLikes + "LikeContainer";
                                    post += '<div class="post-container common-info-block-text">';
                                    // post += '<div>' + result[i]["PublisherName"] + " " + result[i]["PublisherSername"] + " (" + result[i]["PublisherIdentityName"] + ')</div>';
                                    post += '<div>' + result[i]["PublishDate"].replace("T", " at ") + '</div>';
                                    post += '<div class="hashtags-container">';

                                    for (var j = 0; j < result[i]["Hashtags"].length; j++) {
                                        post += ' <div class="hashtag">' + result[i]["Hashtags"][j] + '</div>';
                                    }
                                    post += '</div><hr/>';
                                    post += '<div>' + result[i]["Content"] + '</div><hr/>';//onclick="Like(' + result[i]["Id"] + ',' + publishedPostsLikesId + ')"
                                    post += '<div><a onclick="setLike('+result[i]["Id"]+','+"'"+publishedPostsLikesId+"'"+')"><span class="glyphicon glyphicon-heart"></span></a> Likes <span id=' + publishedPostsLikesId + '>' + result[i]["Likes"] + '</span>';
                                    post += '&nbsp&nbspReposts ' + result[i]["Reposts"] + '</div>';
                                    post += '</div><br>';

                                    publishedPostsLikes++;
                                    publicationsContainer.append(post);
                                    post = "";
                                }
                            }


                        }
                    });

                    $.ajax({
                        type: 'post',
                        url: '/Post/Publications',
                        data: { "offset": 0, "identityName": identityName, "count": 10, "postType": "reposts" },
                        success: function (jsonResult) {
                            var repostsContainer = $('#repostsContainer');
                            var result = JSON.parse(jsonResult);

                            if (result["errorMessage"]) {
                                repostsContainer.empty();
                                repostsContainer.append('<div id="noRepostsErrorMessage" style="text-align:center;"class="common-info-block-text">' + result["errorMessage"] + '</div>');
                                return;
                            }
                            else {
                                post = "";
                                for (var i = 0; i < result.length; i++) {
                                    repostsLikesId = repostsLikes + "repostLikeContainer";
                                    post += '<div class="post-container common-info-block-text">';
                                    post += '<div>' + result[i]["PublisherName"] + " " + result[i]["PublisherSername"] + " (" + result[i]["PublisherIdentityName"] + ')</div>';
                                    post += '<div>' + result[i]["PublishDate"].replace("T", " at ") + '</div>';
                                    post += '<div class="hashtags-container">';

                                    for (var j = 0; j < result[i]["Hashtags"].length; j++) {
                                        post += ' <div class="hashtag">' + result[i]["Hashtags"][j] + '</div>';
                                    }
                                    post += '</div><hr/>';
                                    post += '<div>' + result[i]["Content"] + '</div><hr/>';//onclick="Like(' + result[i]["Id"] + ',' + publishedPostsLikesId + ')"
                                    post += '<div><a onclick="setLike(' + result[i]["Id"] + ',' + "'" + repostsLikesId + "'" + ')"><span class="glyphicon glyphicon-heart"></span></a> Likes <span id=' + repostsLikesId + '>' + result[i]["Likes"] + '</span>';
                                    post += '&nbsp&nbspReposts ' + result[i]["Reposts"] + '</div>';
                                    post += '</div><br>';

                                    repostsLikes++;
                                    publicationsContainer.append(post);
                                    post = "";
                                }
                            }

                        }
                        
                    });

                });

            </script>


        </div>
    </div>
    <div class="container">
        <hr />
        <footer>
            <p>&copy; @DateTime.Now.Year - SocialNetwork</p>
        </footer>
    </div>

</body>
</html>